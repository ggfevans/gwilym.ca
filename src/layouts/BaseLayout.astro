---
import BaseHead from '@components/BaseHead.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import '@styles/global.css';

interface Props {
  title: string;
  description: string;
  image?: string;
  imageWidth?: number;
  imageHeight?: number;
  accent?: 'p1-violet' | 'p2-rose' | 'p3-emerald' | 'p4-amber' | 'p5-sky' | 'neutral';
  breadcrumbs?: { label: string; href?: string }[];
}

const { title, description, image, imageWidth, imageHeight, accent, breadcrumbs } = Astro.props;
---

<!doctype html>
<html lang="en" data-accent={accent}>
  <head>
    <BaseHead title={title} description={description} image={image} imageWidth={imageWidth} imageHeight={imageHeight} />
    <slot name="head" />
    <script is:inline>
      // Initialize theme before page renders to prevent flash
      // This is the single source of truth for theme initialization
      try { var stored = localStorage.getItem('theme'); } catch (e) { var stored = null; }
      try { var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches; } catch (e) { var prefersDark = true; }
      var theme = stored || (prefersDark ? 'dark' : 'light');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      // Expose to Svelte components so they can read initial state without re-initializing
      window.__theme = theme;
    </script>
  </head>
  <body>
    <a href="#main-content" class="gw-skip-link">Skip to content</a>
    <Header breadcrumbs={breadcrumbs} />
    <slot />
    <Footer />
  </body>
</html>

<style>
  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  main {
    flex: 1;
    padding: var(--space-8, 2rem) var(--space-6, 1.5rem);
  }

  .gw-skip-link {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    clip-path: inset(50%);
    white-space: nowrap;
    border: 0;
  }

  .gw-skip-link:focus {
    position: fixed;
    top: 0;
    left: 0;
    width: auto;
    height: auto;
    padding: 8px 16px;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
    background: var(--colour-accent-primary);
    color: var(--colour-bg-primary);
    z-index: 100;
    border-radius: 0 0 4px 0;
  }
</style>
