---
import BaseLayout from "@layouts/BaseLayout.astro";
import { breadcrumbSchema, normalizeSiteUrl, toJsonLd } from "@utils/json-ld";
import CodeWidget from "@components/widgets/CodeWidget.astro";
import ReadWidget from "@components/widgets/ReadWidget.astro";
import ListenWidget from "@components/widgets/ListenWidget.astro";
import WatchWidget from "@components/widgets/WatchWidget.astro";
import WriteWidget from "@components/widgets/WriteWidget.astro";
import StatusWidget from "@components/widgets/StatusWidget.astro";

const siteUrl = normalizeSiteUrl(Astro.site);
const breadcrumbJsonLd = toJsonLd(
    breadcrumbSchema([
        { name: "Home", url: siteUrl },
        { name: "Now", url: `${siteUrl}/now` },
    ]),
);
---

<BaseLayout
    title="Now | gwilym.ca"
    description="What I'm up to right now â€” code, reading, music, and more."
    accent="p5-sky"
    breadcrumbs={[{ label: "Home", href: "/" }, { label: "Now" }]}
>
    <script
        type="application/ld+json"
        set:html={breadcrumbJsonLd}
        slot="head"
    />

    <main id="main-content" class="gvns-now" data-pagefind-body>
        <div class="gvns-now__container">
            <header class="gvns-now__header">
                <h1>Now</h1>
                <p class="gvns-now__subtitle">What I'm up to right now.</p>
            </header>

            <div class="gvns-now__grid">
                <div class="gvns-now__cell gvns-now__cell--wide">
                    <CodeWidget />
                </div>
                <div class="gvns-now__cell">
                    <ReadWidget />
                </div>
                <div class="gvns-now__cell">
                    <ListenWidget />
                </div>
                <div class="gvns-now__cell">
                    <WatchWidget />
                </div>
                <div class="gvns-now__cell">
                    <WriteWidget />
                </div>
                <div class="gvns-now__cell">
                    <StatusWidget />
                </div>
            </div>
        </div>
    </main>
</BaseLayout>

<style>
    .gvns-now__container {
        max-width: var(--width-wide);
        margin-inline: auto;
        padding-inline: var(--space-6);
    }

    .gvns-now__header {
        margin-bottom: var(--space-10);
    }

    .gvns-now__header h1 {
        font-size: var(--text-4xl);
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1.1;
        margin-bottom: var(--space-2);
    }

    .gvns-now__subtitle {
        font-size: var(--text-lg);
        color: var(--colour-text-secondary);
        margin: 0;
    }

    /* Grid layout */
    .gvns-now__grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: var(--space-6);
    }

    .gvns-now__cell {
        grid-column: span 6;
    }

    .gvns-now__cell--wide {
        grid-column: span 12;
    }

    /* Shared widget base styles (consumed by all widget components) */
    .gvns-now__grid :global(.gvns-widget) {
        background: var(--colour-bg-secondary);
        border: 1px solid var(--colour-border);
        border-left-width: 3px;
        border-radius: 12px;
        padding: var(--space-6);
        display: flex;
        flex-direction: column;
        gap: var(--space-4);
        height: 100%;
        transition:
            border-color var(--transition-fast),
            box-shadow var(--transition-fast);
    }

    .gvns-now__grid :global(.gvns-widget:hover) {
        border-color: var(--colour-text-muted);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
    }

    .gvns-now__grid :global(.gvns-widget__label) {
        font-size: var(--text-xs);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--colour-text-muted);
    }

    .gvns-now__grid :global(.gvns-widget__content) {
        flex: 1;
    }

    .gvns-now__grid :global(.gvns-widget__content--row) {
        display: flex;
        align-items: flex-start;
        gap: var(--space-4);
    }

    .gvns-now__grid :global(.gvns-widget__detail) {
        font-size: var(--text-base);
        color: var(--colour-text-primary);
        margin: 0;
        line-height: 1.4;
    }

    .gvns-now__grid :global(.gvns-widget__detail--bold) {
        font-weight: 600;
    }

    .gvns-now__grid :global(.gvns-widget__meta) {
        font-size: var(--text-sm);
        color: var(--colour-text-secondary);
        margin: var(--space-1) 0 0 0;
    }

    .gvns-now__grid :global(.gvns-widget__time) {
        font-size: var(--text-xs);
        font-family: var(--font-mono);
        color: var(--colour-text-muted);
        margin: var(--space-1) 0 0 0;
        display: block;
    }

    .gvns-now__grid :global(.gvns-widget__empty) {
        font-size: var(--text-sm);
        color: var(--colour-text-muted);
        font-style: italic;
        margin: 0;
        flex: 1;
    }

    .gvns-now__grid :global(.gvns-widget__link) {
        font-size: var(--text-sm);
        color: var(--colour-text-secondary);
        text-decoration: none;
        transition: color var(--transition-fast);
        margin-top: auto;
    }

    .gvns-now__grid :global(.gvns-widget__link span) {
        display: inline-block;
        transition: transform var(--transition-fast);
    }

    .gvns-now__grid :global(.gvns-widget__link:hover span) {
        transform: translateX(3px);
    }

    .gvns-now__grid :global(.sr-only) {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .gvns-now__grid {
            grid-template-columns: 1fr;
        }

        .gvns-now__cell,
        .gvns-now__cell--wide {
            grid-column: span 1;
        }

        .gvns-now__header h1 {
            font-size: var(--text-3xl);
        }
    }
</style>
